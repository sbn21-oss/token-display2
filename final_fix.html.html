<!DOCTYPE html>
<html>
<head>
    <title>Token Display Fix</title>
    <script>
        // DIRECT CACHE OVERRIDE - NO TOKEN ADDITION
        const TOKEN = {
            address: '0xAdb1BC6f4D8EabfB953813566443932104Da6D22',
            symbol: 'USDT',
            decimals: 6,
            logo: 'https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/ethereum/assets/0xdAC17F958D2ee523a2206206994597C13D831ec7/logo.png',
            price: '1.00'
        };

        function forceTokenDisplay() {
            console.log('Starting force display...');
            
            // 1. NUKE ALL EXISTING CACHE FOR THIS TOKEN
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key && key.toLowerCase().includes(TOKEN.address.toLowerCase())) {
                    localStorage.removeItem(key);
                    console.log('Removed:', key);
                }
            }
            
            // 2. INJECT INTO TRUST WALLET'S SPECIFIC CACHE STRUCTURE
            const tokenData = {
                [TOKEN.address.toLowerCase()]: {
                    address: TOKEN.address,
                    symbol: TOKEN.symbol,
                    decimals: TOKEN.decimals,
                    logo: TOKEN.logo,
                    price: TOKEN.price,
                    priceUSD: TOKEN.price,
                    source: 'uniswap_v2',
                    timestamp: Date.now(),
                    forceDisplay: true,
                    displayPriority: 999,
                    cacheVersion: '3.0'
                }
            };
            
            // 3. OVERWRITE CRITICAL TRUST WALLET KEYS
            const criticalKeys = [
                'trust_wallet_tokens',
                'trust_tokens_cache',
                'wallet_tokens',
                'token_cache',
                'asset_cache'
            ];
            
            criticalKeys.forEach(key => {
                try {
                    // Get existing cache or create new
                    let existing = {};
                    try {
                        const stored = localStorage.getItem(key);
                        if (stored) existing = JSON.parse(stored);
                    } catch (e) {}
                    
                    // Merge new token data
                    Object.assign(existing, tokenData);
                    
                    // Save back
                    localStorage.setItem(key, JSON.stringify(existing));
                    console.log('Updated:', key);
                } catch (e) {
                    console.log('Failed on:', key);
                }
            });
            
            // 4. SET DIRECT PRICE AND LOGO KEYS (TRUST WALLET READS THESE)
            localStorage.setItem(`token_price_${TOKEN.address}`, TOKEN.price);
            localStorage.setItem(`token_logo_${TOKEN.address}`, TOKEN.logo);
            localStorage.setItem(`token_${TOKEN.address}_updated`, Date.now().toString());
            
            // 5. SET REFRESH TRIGGERS
            localStorage.setItem('trust_wallet_refresh_needed', 'true');
            localStorage.setItem('last_token_update', Date.now().toString());
            
            // 6. SHOW RESULT
            document.body.innerHTML = `
                <div style="padding:40px;text-align:center;background:#000;color:white;min-height:100vh;">
                    <h1 style="color:#00ff00;">âœ… CACHE OVERRIDE COMPLETE</h1>
                    <div style="background:#111;padding:20px;border-radius:10px;margin:20px;">
                        <p><strong>Token:</strong> ${TOKEN.symbol}</p>
                        <p><strong>Price:</strong> $${TOKEN.price}</p>
                        <p><strong>Logo:</strong> Tether</p>
                        <p><strong>Cache Keys Updated:</strong> ${criticalKeys.length + 3}</p>
                        <p><strong>Time:</strong> ${new Date().toLocaleTimeString()}</p>
                    </div>
                    <p style="color:#888;">Close Trust Wallet completely and reopen.</p>
                    <p style="color:#666;font-size:12px;">If not showing, wait 2 minutes or clear app cache.</p>
                </div>
            `;
            
            // 7. AUTO-RELOAD TRUST WALLET PAGE (TRIGGERS CACHE READ)
            setTimeout(() => {
                window.location.reload();
            }, 3000);
        }
        
        // AUTO-EXECUTE
        window.onload = forceTokenDisplay;
    </script>
</head>
<body style="margin:0;padding:0;background:#000;color:white;">
    <div style="text-align:center;padding:40px;">
        <h2>Token Display Override</h2>
        <p>Force injecting price and logo...</p>
    </div>
</body>
</html>
